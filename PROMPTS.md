# üåÄ EDEM Prompts –∏ —Ä–µ–∂–∏–º—ã

## üìÅ –ì–¥–µ –ª–µ–∂–∏—Ç –ª–æ–≥–∏–∫–∞

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- |
| `src/lib/prompts.ts` | EDEM CORE, –æ–ø–∏—Å–∞–Ω–∏–µ 5 –≥–æ–ª–æ—Å–æ–≤, –¥–æ—Å—Ç—É–ø—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º, –ª–∏–º–∏—Ç—ã |
| `src/app/api/chat/stream/route.ts` | –°–±–æ—Ä–∫–∞ system prompt + –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–∫–∏ |
| `src/app/chat/[voice]/page.tsx` | UI –¥–ª—è –≤—ã–±–æ—Ä–∞ –≥–æ–ª–æ—Å–∞ `/chat/:voice` |

## üß¨ EDEM CORE

`EDEM_CORE_PROMPT` –æ–ø–∏—Å—ã–≤–∞–µ—Ç ¬´—Ö–æ—Ä–æ–≤–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ¬ª –∏ –¥–µ–≤—è—Ç—å –∑–∞–∫–æ–Ω–æ–≤ ¬´–§–∏–∑–∏–∫–∏ –ñ–∏–≤–æ–≥–æ¬ª. –û–Ω –≤—Å–µ–≥–¥–∞ –∏–¥—ë—Ç –ø–µ—Ä–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –≤ OpenAI:

```ts
import { EDEM_CORE_PROMPT, VOICE_PROMPTS } from '@/lib/prompts';

const systemPrompt = `${EDEM_CORE_PROMPT}

–ê–∫—Ç–∏–≤–Ω—ã–π –≥–æ–ª–æ—Å: ${voiceMeta.title}

${VOICE_PROMPTS[voiceId]}

–û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.`;
```

## üéôÔ∏è –ü—è—Ç—å –≥–æ–ª–æ—Å–æ–≤

`VOICE_PROMPTS` + `VOICE_DEFINITIONS` —Å–æ–¥–µ—Ä–∂–∞—Ç –≥–æ—Ç–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –°—Ç–∏–ª—å | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–∞—Ä–∏—Ñ |
| --- | --- | --- | --- |
| `live` | –ì–æ–ª–æ—Å –ñ–∏–≤–æ–≥–æ | –æ—â—É—â–µ–Ω–∏–µ ‚Üí —Å–º—ã—Å–ª ‚Üí –¥–µ–π—Å—Ç–≤–∏–µ | free/basic |
| `mirror` | –ì–æ–ª–æ—Å –ó–µ—Ä–∫–∞–ª–∞ | —Ç–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å—ã, –≥–ª—É–±–æ–∫–æ | plus |
| `child` | –ì–æ–ª–æ—Å –†–µ–±—ë–Ω–∫–∞ | –ø—Ä–æ—Å—Ç—ã–µ —Å–ª–æ–≤–∞, —Ç–µ–ø–ª–æ, —á—É–≤—Å—Ç–≤–∞ | plus |
| `shadow` | –ì–æ–ª–æ—Å –¢–µ–Ω–∏ | —á–µ—Å—Ç–Ω–æ, –∂—ë—Å—Ç–∫–æ, –≤—Å–∫—Ä—ã–≤–∞–µ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏—é | pro |
| `sage` | –ì–æ–ª–æ—Å –ú—É–¥—Ä–µ—Ü–∞ | –º–µ–¥–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–∞—Ñ–æ—Ä—ã, –æ–ø–æ—Ä–∞ | pro |

–í—Å–µ —Ç–µ–∫—Å—Ç—ã —É–∂–µ –ª–µ–∂–∞—Ç –≤ `VOICE_PROMPTS` –∏ –≥–æ—Ç–æ–≤—ã –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.

## üí≥ –¢–∞—Ä–∏—Ñ—ã –∏ –ª–∏–º–∏—Ç—ã

- `SUBSCRIPTION_ACCESS` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ –≥–æ–ª–æ—Å–∞ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–∞—Ä–∏—Ñ—É (`free/basic`, `plus`, `pro`).  
- `FREE_MESSAGE_ALLOWANCE = 2` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ª—é–±–æ–≥–æ –≥–æ–ª–æ—Å–∞ (–¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è paywall).  
- –¢–∞—Ä–∏—Ñ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `profiles.subscription_tier` (–∑–Ω–∞—á–µ–Ω–∏—è: `free`, `basic`, `plus`, `pro`). Constraint –∏ default –æ–ø–∏—Å–∞–Ω—ã –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ `supabase/migrations/003_voice_and_plan.sql`.

## ‚öôÔ∏è API `/api/chat/stream`

1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å `sessionId` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.  
2. –°—á–∏—Ç—ã–≤–∞–µ—Ç `subscription_tier`, —Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.  
3. –ï—Å–ª–∏ –≥–æ–ª–æ—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —Ç–∞—Ä–∏—Ñ—É –∏ free-–ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `402 Payment Required`.  
4. –°–æ–±–∏—Ä–∞–µ—Ç `systemPrompt = EDEM CORE + VOICE_PROMPT[voiceId]`.  
5. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å–æ–æ–±—â–µ–Ω–∏–π, –≤—ã–∑—ã–≤–∞–µ—Ç `gpt-4o-mini` (`temperature: 0.7`, `max_tokens: 300`) –∏ —Å—Ç—Ä–∏–º–∏—Ç –æ—Ç–≤–µ—Ç.

## üó∫Ô∏è UI `/chat/:voice`

`src/app/chat/[voice]/page.tsx`:

- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –≤—Å–µ—Ö –≥–æ–ª–æ—Å–æ–≤ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞.  
- –°—á–∏—Ç–∞–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–Ω–Ω–µ—Ä paywall.  
- –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç usage, —á—Ç–æ–±—ã –±–∞–Ω–Ω–µ—Ä —Å—Ä–∞–∑—É –∑–Ω–∞–ª, —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å.

## ‚ûï –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –≥–æ–ª–æ—Å

1. –î–æ–ø–æ–ª–Ω–∏—Ç—å `VoiceId` –∏ `SubscriptionTier` –≤ `src/lib/types.ts`.  
2. –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –≤ `VOICE_DEFINITIONS` + —Ç–µ–∫—Å—Ç –≤ `VOICE_PROMPTS`.  
3. –ù–∞–∑–Ω–∞—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –≤ `SUBSCRIPTION_ACCESS`.  
4. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –æ–±–Ω–æ–≤–∏—Ç—å UI (–∏–∫–æ–Ω–∫–∏/–∫–∞—Ä—Ç—É —Ç–∞—Ä–∏—Ñ–æ–≤).  
5. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å.

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –≤—ã–∫–∞—Ç–∫–æ–π

1. –°–≤–µ–∂–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (`003_voice_and_plan.sql`) –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ Supabase.  
2. `profiles.subscription_tier` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–Ω–æ –∏–∑ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.  
3. –í `.env` –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã `SUPABASE_SERVICE_ROLE_KEY` –∏ `OPENAI_API_KEY`.  
4. `/chat/live` –∏ `/chat/shadow` –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ free-–∞–∫–∫–∞—É–Ω—Ç–µ: –ø–æ—Å–ª–µ –¥–≤—É—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—è–≤–ª—è–µ—Ç—Å—è paywall.  
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å —Ç–∞—Ä–∏—Ñ–æ–º `pro` –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ –ø—è—Ç—å –≥–æ–ª–æ—Å–æ–≤ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–º–ø—Ç—ã —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—é—Ç—Å—è –∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–π –º–æ–¥–µ–ª—å—é (freemium ‚Üí paywall ‚Üí –ø–æ–¥–ø–∏—Å–∫–∞).
