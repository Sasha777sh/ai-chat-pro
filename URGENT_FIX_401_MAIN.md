# üö® –°–†–û–ß–ù–û: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É 401 –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

## ‚úÖ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û: –û—à–∏–±–∫–∞ 401 –≤—Å—ë –µ—â—ë –µ—Å—Ç—å

**–ì–¥–µ:** –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `https://chatedem.com/` (–Ω–µ `/demo`!)

**API:** `/api/chat/stream` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ)

**–°—Ç–∞—Ç—É—Å:** ‚ùå –û—à–∏–±–∫–∞ 401 "Your authentication token is not from a valid issuer"

---

## üéØ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Vercel (90% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã)

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û—Ç–∫—Ä–æ–π: https://vercel.com/dashboard
2. –ù–∞–π–¥–∏ –ø—Ä–æ–µ–∫—Ç —Å –¥–æ–º–µ–Ω–æ–º `chatedem.com`
3. –û—Ç–∫—Ä–æ–π: Settings ‚Üí Environment Variables

**–ü—Ä–æ–≤–µ—Ä—å —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

```
NEXT_PUBLIC_SUPABASE_URL = https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY = eyJ... (anon/public key!)
SUPABASE_SERVICE_ROLE_KEY = eyJ... (service role key)
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å:**
1. –û—Ç–∫—Ä–æ–π: https://supabase.com/dashboard
2. –ù–∞–π–¥–∏ –ø—Ä–æ–µ–∫—Ç ‚Üí Settings ‚Üí API
3. –°—Ä–∞–≤–Ω–∏ –∫–ª—é—á–∏:
   - **anon/public key** ‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - **service_role key** ‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `SUPABASE_SERVICE_ROLE_KEY`

**‚ö†Ô∏è –í–ê–ñ–ù–û:** 
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **anon/public key**, –ù–ï service role key!
- –ï—Å–ª–∏ —Ç–∞–º service role key ‚Üí —ç—Ç–æ –∏ –µ—Å—Ç—å –ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏ 401!

**–ï—Å–ª–∏ –∫–ª—é—á–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç:**
1. –°–∫–æ–ø–∏—Ä—É–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –∏–∑ Supabase
2. –û–±–Ω–æ–≤–∏ –Ω–∞ Vercel (Settings ‚Üí Environment Variables)
3. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø–µ—Ä–µ–¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç:**
   - Vercel Dashboard ‚Üí Deployments ‚Üí Redeploy
   - –ò–ª–∏ —á–µ—Ä–µ–∑ Git: `git commit --allow-empty -m "Redeploy" && git push`

---

### –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Vercel

**–î–µ–π—Å—Ç–≤–∏—è:**
1. Vercel Dashboard ‚Üí Functions ‚Üí Logs
2. –û—Ç–ø—Ä–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
3. –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- –û—à–∏–±–∫–∏ "Invalid JWT" –∏–ª–∏ "token is not from a valid issuer"
- –û—à–∏–±–∫–∏ "NEXT_PUBLIC_SUPABASE_ANON_KEY is not defined"
- –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ó–∞–ø–∏—à–∏:**
- –¢–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
- –°—Ç–µ–∫ —Ç—Ä–µ–π—Å (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

### –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥ (–µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ)

**–§–∞–π–ª:** `src/app/api/chat/stream/route.ts`

**–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

```typescript
// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;

// –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º anon key:
const supabaseAuth = createClient(supabaseUrl, supabaseAnonKey);
const { data: { user }, error: authError } = await supabaseAuth.auth.getUser(token);
```

**–ï—Å–ª–∏ –∫–æ–¥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:**
1. –ò—Å–ø—Ä–∞–≤—å –∫–æ–¥
2. –ó–∞–∫–æ–º–º–∏—Ç—å: `git add . && git commit -m "Fix: 401 auth error" && git push`

---

### –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä—å —Ç–æ–∫–µ–Ω –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

**–§–∞–π–ª:** `src/app/page.tsx`

**–ü—Ä–æ–≤–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏—é `handleSend`:**

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```typescript
// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç —Ç–æ–∫–µ–Ω –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
const { data: { user }, error: userError } = await supabase.auth.getUser();
if (userError || !user) {
  // –æ—à–∏–±–∫–∞
}

// –ü–æ–ª—É—á–∞–µ–º —Å–µ—Å—Å–∏—é
let { data: { session }, error: sessionError } = await supabase.auth.getSession();
if (!session) {
  // –ø—Ä–æ–±—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å
  const { data: { session: refreshed } } = await supabase.auth.refreshSession();
  session = refreshed;
}

// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω
Authorization: `Bearer ${session.access_token}`
```

**–ü—Ä–æ–≤–µ—Ä—å:**
- –¢–æ–∫–µ–Ω –Ω–µ –ø—É—Å—Ç–æ–π?
- –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization`?

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "token is not from a valid issuer":

**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å `NEXT_PUBLIC_SUPABASE_ANON_KEY` –Ω–∞ Vercel
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —ç—Ç–æ anon key, –∞ –Ω–µ service role key
3. –û–±–Ω–æ–≤–∏ –Ω–∞ Vercel –∏ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–π

### –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "NEXT_PUBLIC_SUPABASE_ANON_KEY is not defined":

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ Vercel
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–ª—è Production
3. –ü–µ—Ä–µ–¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç

### –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –ø—É—Å—Ç–æ–π:

**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –í—ã–π–¥–∏ –∏ –≤–æ–π–¥–∏ —Å–Ω–æ–≤–∞
2. –ü—Ä–æ–≤–µ—Ä—å cookies –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. –û—á–∏—Å—Ç–∏ cookies –∏ –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢

- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ Vercel
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY` = anon/public key (–ù–ï service role!)
- [ ] –ö–ª—é—á–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å Supabase
- [ ] –ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–¥–µ–ø–ª–æ–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ –æ—à–∏–±–∫–∏
- [ ] –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `supabaseAnonKey` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞
- [ ] –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —Å –∫–ª–∏–µ–Ω—Ç–∞

---

## üöÄ –ù–ê–ß–ù–ò –° –®–ê–ì–ê 1

**90% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Vercel!**

**–ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π:**
1. –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ Vercel (–®–ê–ì 1)
2. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ ‚Üí –ø—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ (–®–ê–ì 2)
3. –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä—å –∫–æ–¥ (–®–ê–ì 3)

---

## üí° –ë–´–°–¢–†–´–ô –§–ò–ö–°

**–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

1. **–õ–æ–∫–∞–ª—å–Ω–æ:**
   ```bash
   cd /Users/sanecek/tema/ai-chat-pro
   cat .env.local | grep SUPABASE
   ```
   –°—Ä–∞–≤–Ω–∏ —Å Vercel ‚Üí –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å!

2. **–ù–∞ Vercel:**
   - Settings ‚Üí Environment Variables
   - –ü—Ä–æ–≤–µ—Ä—å `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å anon/public key, –ù–ï service role key!

3. **–ü–µ—Ä–µ–¥–µ–ø–ª–æ–π:**
   - Vercel Dashboard ‚Üí Deployments ‚Üí Redeploy
   - –ò–ª–∏: `git commit --allow-empty -m "Redeploy" && git push`

---

**–ò—Å–ø—Ä–∞–≤—å —ç—Ç–æ –∏ —á–∞—Ç –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç! üöÄ**

