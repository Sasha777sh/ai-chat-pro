# ‚ö†Ô∏è –ê–ì–ï–ù–¢ –û–®–ò–ë–°–Ø: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

## ‚ùå –ß–¢–û –°–ö–ê–ó–ê–õ –ê–ì–ï–ù–¢

**–ê–≥–µ–Ω—Ç —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç:**
> "The root cause of the 401 error is an invalid/expired OpenAI API key"

**–≠—Ç–æ –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!**

---

## ‚úÖ –†–ï–ê–õ–¨–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

**–û—à–∏–±–∫–∞ 401 "Your authentication token is not from a valid issuer"** –≤–æ–∑–Ω–∏–∫–∞–µ—Ç **–î–û** –≤—ã–∑–æ–≤–∞ OpenAI API!

**–ì–¥–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:**
```typescript
// src/app/api/chat/stream/route.ts, —Å—Ç—Ä–æ–∫–∞ 80
const { data: { user }, error: authError } = await supabaseAuth.auth.getUser(token);

if (authError || !user) {
  // ‚Üê –û–®–ò–ë–ö–ê 401 –í–û–ó–ù–ò–ö–ê–ï–¢ –ó–î–ï–°–¨!
  return new Response(JSON.stringify({ error: authError?.message || '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' }), { status: 401 });
}
```

**–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–æ–∫–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Supabase
- **–î–û** –≤—ã–∑–æ–≤–∞ OpenAI API
- OpenAI API –≤–æ–æ–±—â–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ 401

---

## üîç –î–û–ö–ê–ó–ê–¢–ï–õ–¨–°–¢–í–ê

### 1. –ö–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

```typescript
// 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ Supabase (—Å—Ç—Ä–æ–∫–∞ 80)
const { data: { user }, error: authError } = await supabaseAuth.auth.getUser(token);
if (authError || !user) {
  return new Response(..., { status: 401 }); // ‚Üê –û–®–ò–ë–ö–ê –ó–î–ï–°–¨
}

// 2. OpenAI API –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ (—Å—Ç—Ä–æ–∫–∞ 201)
const completion = await openai.chat.completions.create({...});
```

**–í—ã–≤–æ–¥:** –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 401, OpenAI API –≤–æ–æ–±—â–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è!

### 2. –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏:

**–û—à–∏–±–∫–∞:** "Your authentication token is not from a valid issuer"

**–≠—Ç–æ –æ—à–∏–±–∫–∞ Supabase JWT —Ç–æ–∫–µ–Ω–∞**, –∞ –Ω–µ OpenAI API!

**OpenAI API –æ—à–∏–±–∫–∏ –≤—ã–≥–ª—è–¥—è—Ç —Ç–∞–∫:**
- "Invalid API key"
- "Incorrect API key provided"
- "You exceeded your current quota"

**–ù–ï "Your authentication token is not from a valid issuer"!**

---

## ‚úÖ –†–ï–ê–õ–¨–ù–ê–Ø –ü–†–ò–ß–ò–ù–ê –û–®–ò–ë–ö–ò 401

**90% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Supabase –Ω–∞ Vercel

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ:**
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` —Å–æ–¥–µ—Ä–∂–∏—Ç service role key –≤–º–µ—Å—Ç–æ anon key
- –ò–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–æ–æ–±—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞ Vercel
- –ò–ª–∏ –ø—Ä–æ–µ–∫—Ç –Ω–µ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

---

## üéØ –ß–¢–û –ù–£–ñ–ù–û –î–ï–õ–ê–¢–¨

### –ù–ï –Ω—É–∂–Ω–æ:
- ‚ùå –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π OpenAI API –∫–ª—é—á
- ‚ùå –û–±–Ω–æ–≤–ª—è—Ç—å OPENAI_API_KEY –Ω–∞ Vercel

### –ù–£–ñ–ù–û:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Supabase –Ω–∞ Vercel
- ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `NEXT_PUBLIC_SUPABASE_ANON_KEY` = anon key (–Ω–µ service role!)
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ Vercel
- ‚úÖ –ü–µ—Ä–µ–¥–µ–ø–ª–æ–∏—Ç—å –ø—Ä–æ–µ–∫—Ç

---

## üìã –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### 1. –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Supabase –Ω–∞ Vercel

**–û—Ç–∫—Ä–æ–π:**
- https://vercel.com/dashboard
- –ù–∞–π–¥–∏ –ø—Ä–æ–µ–∫—Ç
- Settings ‚Üí Environment Variables

**–ü—Ä–æ–≤–µ—Ä—å:**
- `NEXT_PUBLIC_SUPABASE_URL` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `https://jgnnrdrqzcwnhuuvhlfo.supabase.co`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å anon key (–ø—Ä–æ–≤–µ—Ä—å –Ω–∞ jwt.io - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `"role":"anon"`)
- `SUPABASE_SERVICE_ROLE_KEY` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å service role key (–ø—Ä–æ–≤–µ—Ä—å –Ω–∞ jwt.io - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `"role":"service_role"`)

### 2. –ï—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ - –æ–±–Ω–æ–≤–∏

**–ü–æ–ª—É—á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```bash
cd /Users/sanecek/tema/ai-chat-pro
./get-vercel-env.sh
```

**–°–∫–æ–ø–∏—Ä—É–π –∏ –æ–±–Ω–æ–≤–∏ –Ω–∞ Vercel**

### 3. –ü–µ—Ä–µ–¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–π –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö!**

---

## üîç –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨, –ß–¢–û –ü–†–û–ë–õ–ï–ú–ê –í SUPABASE

**1. –û—Ç–∫—Ä–æ–π –ª–æ–≥–∏ Vercel:**
- Vercel Dashboard ‚Üí Functions ‚Üí Logs
- –û—Ç–ø—Ä–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
- –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏

**2. –ù–∞–π–¥–∏ –æ—à–∏–±–∫—É:**
- –ï—Å–ª–∏ –≤–∏–¥–∏—à—å "Your authentication token is not from a valid issuer" ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ Supabase
- –ï—Å–ª–∏ –≤–∏–¥–∏—à—å "Invalid API key" ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ OpenAI (–Ω–æ —ç—Ç–æ –Ω–µ –Ω–∞—à —Å–ª—É—á–∞–π!)

**3. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥:**
- –û—à–∏–±–∫–∞ 401 –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–æ–∫–µ 80 –≤ `route.ts`
- –≠—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ Supabase —Ç–æ–∫–µ–Ω–∞, –Ω–µ OpenAI API

---

## ‚úÖ –í–´–í–û–î

**–ê–≥–µ–Ω—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏–ª –ø—Ä–æ–±–ª–µ–º—É!**

**–†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Supabase –Ω–∞ Vercel
- –ù–ï –ø—Ä–æ–±–ª–µ–º–∞ —Å OpenAI API –∫–ª—é—á–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Supabase –Ω–∞ Vercel
- –ü–µ—Ä–µ–¥–µ–ø–ª–æ–∏—Ç—å –ø—Ä–æ–µ–∫—Ç

**–ù–ï –Ω—É–∂–Ω–æ:**
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π OpenAI API –∫–ª—é—á
- –û–±–Ω–æ–≤–ª—è—Ç—å OPENAI_API_KEY

---

**–ò—Å–ø—Ä–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Supabase –Ω–∞ Vercel - —ç—Ç–æ —Ä–µ—à–∏—Ç –ø—Ä–æ–±–ª–µ–º—É! üöÄ**

